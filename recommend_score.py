import json
import numpy as np
import heapq

file = open('ehrecord.json', 'r', encoding='utf-8-sig')
site_data = {i: json.loads(line) for i, line in enumerate(file)}

doujin_list = {}
score_list = {}
score_data = {'language:chinese': 192.99499999999722, 'language:translated': 198.26499999999712, 'group:kharisma jati': 1, 'character:mito tsukino': 3.194999999999996, 'group:yudokuya': 3.2049999999999956, 'artist:tomokichi': 3.2149999999999954, 'male:sole male': 57.194999999999304, 'female:bunny girl': 3.234999999999995, 'female:kemonomimi': 6.409999999999949, 'female:leotard': 7.3549999999999285, 'female:pantyhose': 3.2649999999999944, 'female:sole female': 46.069999999999446, 'parody:love live': 2.089999999999998, 'character:maki nishikino': 2.094999999999998, 'character:nico yazawa': 2.099999999999998, 'group:number2': 2.1049999999999978, 'artist:ohtomo takuji': 2.1099999999999977, 'female:bikini': 9.254999999999932, 'female:lolicon': 71.7899999999991, 'female:nakadashi': 35.48499999999956, 'female:schoolgirl uniform': 24.53999999999971, 'female:stockings': 26.084999999999702, 'female:swimsuit': 8.584999999999923, 'ffm threesome': 7.874999999999917, 'full color': 49.09499999999932, 'group': 34.51999999999952, 'group:mysp5cm': 7.884999999999917, 'artist:mareo': 7.899999999999917, 'male:anal': 114.9649999999982, 'male:brother': 7.929999999999916, 'male:incest': 9.7199999999999, 'male:males only': 81.48499999999876, 'male:shotacon': 119.1049999999982, 'male:tomgirl': 114.54499999999825, 'male:yaoi': 103.92999999999839, 'parody:shadowverse': 2.2949999999999937, 'group:mousou caution': 2.2999999999999936, 'artist:daiaru': 2.3049999999999935, 'female:ahegao': 21.25999999999976, 'female:big breasts': 8.444999999999904, 'female:blindfold': 2.324999999999993, 'female:bondage': 22.699999999999775, 'female:collar': 11.884999999999874, 'female:enema': 4.299999999999972, 'female:human pet': 2.3449999999999926, 'female:masturbation': 4.364999999999971, 'female:piercing': 2.3549999999999924, 'female:pregnant': 5.629999999999944, 'female:slave': 2.364999999999992, 'parody:fate grand order': 20.299999999999716, 'character:astolfo': 13.2699999999998, 'character:gudako': 1, 'group:konnyaku nabe': 1, 'artist:magifuro konnyaku': 1, 'male:crossdressing': 99.97499999999845, 'male:dickgirl on male': 11.804999999999833, 'male:stockings': 51.59499999999923, 'female:futanari': 14.984999999999808, 'female:sole dickgirl': 15.054999999999806, 'parody:sword art online alternative gun gale online': 2.414999999999991, 'character:karen kohiruimaki': 2.419999999999991, 'group:batten kariba': 2.424999999999991, 'artist:mmm': 2.429999999999991, 'male:big penis': 8.424999999999905, 'female:blowjob': 24.859999999999683, 'female:mind control': 21.96999999999972, 'female:stomach deformation': 4.934999999999959, 'female:unusual pupils': 8.609999999999902, 'female:x-ray': 18.18999999999976, 'language:english': 4.479999999999947, 'group:anegaoka sanchoume': 1, 'artist:okyuuri': 1, 'male:blowjob': 13.209999999999825, 'male:bondage': 8.809999999999876, 'male:handjob': 5.184999999999932, 'male:rape': 8.389999999999906, 'female:corset': 1, 'female:femdom': 13.564999999999817, 'female:garter belt': 2.9699999999999793, 'female:teacher': 3.924999999999959, 'female:thigh high boots': 3.4699999999999687, 'artist:hiyozakura': 2.519999999999989, 'artist:tau': 2.564999999999988, 'female:big penis': 9.114999999999892, 'female:clamp': 2.5799999999999876, 'female:ponytail': 4.3349999999999715, 'female:small breasts': 2.604999999999987, 'female:squirting': 2.614999999999987, 'mosaic censorship': 36.89999999999951, 'variant set': 2.6299999999999866, 'parody:neon genesis evangelion': 1, 'character:asuka langley soryu': 1, 'character:rei ayanami': 1, 'character:shinji ikari': 1, 'group:nakayohi': 1, 'artist:izurumi': 1, 'male:schoolboy uniform': 1, 'group:anmichu dou': 1, 'full censorship': 9.909999999999853, 'multi-work series': 17.124999999999783, 'group:antyuumosaku': 1, 'artist:malcorond': 1, 'male:bbm': 21.664999999999708, 'male:glasses': 19.21499999999972, 'female:ball sucking': 1, 'female:glasses': 11.214999999999847, 'female:prostitution': 6.849999999999918, 'female:school swimsuit': 4.714999999999942, 'group:gujira 4 gou': 1, 'artist:gujira': 1, 'male:ahegao': 11.53999999999984, 'male:apron': 1, 'male:bald': 9.719999999999878, 'male:bikini': 1, 'male:dilf': 27.279999999999607, 'male:father': 1, 'male:feminization': 9.419999999999884, 'male:inseki': 1, 'male:mind break': 1, 'male:pantyhose': 12.339999999999822, 'male:schoolgirl uniform': 27.629999999999583, 'male:sex toys': 9.59999999999988, 'male:swimsuit': 1, 'group:high-spirit': 5.434999999999927, 'artist:aogiri penta': 5.439999999999927, 'male:masturbation': 7.734999999999899, 'male:nurse': 5.464999999999926, 'male:prostate massage': 8.789999999999877, 'parody:kantai collection': 17.20999999999978, 'character:akagi': 1, 'character:akatsuki': 1, 'character:akebono': 1, 'character:akizuki': 1, 'character:fubuki': 1, 'character:haruna': 1, 'character:hatsuzuki': 1, 'character:hibiki': 3.1449999999999756, 'character:hiei': 1, 'character:i-401': 1, 'character:ikazuchi': 3.3249999999999718, 'character:isokaze': 1, 'character:jeanne darc': 1, 'character:kaga': 1, 'character:kashima': 2.93499999999998, 'character:kirishima': 1, 'character:kongou': 2.93999999999998, 'character:ooyodo': 1, 'character:prinz eugen': 1, 'character:ro-500': 1, 'character:sazanami': 1, 'character:sendai': 1, 'character:shigure': 1, 'character:shiranui': 1, 'character:shoukaku': 1, 'character:suzutsuki': 1, 'character:suzuya': 1, 'character:teruzuki': 1, 'character:ushio': 1, 'character:uzuki': 1, 'character:yukikaze': 1, 'character:yuubari': 1, 'character:zuikaku': 1, 'artist:jaku denpa': 1, 'male:first person perspective': 1, 'male:military': 2.94499999999998, 'female:anal': 20.479999999999713, 'female:asphyxiation': 7.044999999999914, 'female:bodysuit': 3.6099999999999657, 'female:defloration': 17.249999999999762, 'female:electric shocks': 3.784999999999962, 'female:fisting': 2.9649999999999794, 'female:rape': 23.359999999999673, 'female:sex toys': 6.0749999999999345, 'female:speculum': 1, 'female:torture': 3.7999999999999616, 'female:urination': 9.449999999999884, 'parody:eromanga sensei': 1, 'parody:fate kaleid liner prisma illya': 9.029999999999893, 'parody:kobayashi-san-chi no maid dragon': 1, 'parody:kono subarashii sekai ni syukufuku o': 1, 'parody:one piece': 1, 'parody:re zero kara hajimeru isekai seikatsu': 1, 'character:elf yamada': 1, 'character:illyasviel von einzbern': 9.044999999999892, 'character:kuro von einzbern': 3.069999999999977, 'character:muramasa senju': 1, 'character:ram': 1, 'character:rem': 1, 'character:sagiri izumi': 1, 'artist:aki99': 1, 'female:cunnilingus': 1, 'female:dark skin': 8.394999999999907, 'female:females only': 1, 'female:first person perspective': 1, 'female:yuri': 1, 'uncensored': 6.174999999999932, 'group:notes.': 1, 'artist:takahashi note': 1, 'female:elf': 1, 'female:lab coat': 1, 'character:takao': 1, 'character:teitoku': 7.839999999999918, 'group:hazuki tsuitachi': 1, 'artist:kishimen': 1, 'female:cervix penetration': 4.239999999999952, 'female:lactation': 1, 'female:prolapse': 3.789999999999962, 'female:scat': 7.629999999999901, 'group:supe': 1, 'artist:nakani': 1, 'female:handjob': 7.194999999999911, 'female:sister': 8.359999999999886, 'incest': 8.379999999999885, 'parody:touhou project': 1, 'character:alice margatroid': 1, 'group:haitokukan': 1, 'artist:haitokukan': 1, 'female:impregnation': 9.949999999999873, 'group:ranshi to kimi to.': 3.40999999999997, 'artist:santa': 3.41499999999997, 'female:catgirl': 7.589999999999902, 'female:crotch tattoo': 4.384999999999949, 'female:shared senses': 1, 'female:tail plug': 4.199999999999953, 'group:menteisho': 1, 'artist:menteiyakuna': 1, 'group:canaria': 1, 'artist:konayama kata': 1, 'funmatsu': 1, 'group:aihara hanten': 1, 'artist:aihara shouta': 1, 'artist:kamirenjaku sanpei': 1, 'male:footjob': 1, 'male:frottage': 1, 'male:group': 8.889999999999874, 'male:josou seme': 6.4949999999999255, 'male:nakadashi': 4.654999999999943, 'male:onahole': 1, 'story arc': 10.08499999999987, 'tankoubon': 14.009999999999808, 'character:inazuma': 1, 'group:windtone': 1, 'artist:safi': 1, 'character:bismarck': 1, 'group:atsuya kougyou': 1, 'artist:kaisen chuui': 1, 'male:dark skin': 16.12999999999976, 'female:drugs': 8.114999999999892, 'group:h at break': 1, 'artist:itose ikuto': 1, 'male:cosplaying': 8.494999999999884, 'group:higuma-ya': 1, 'artist:kiyo': 1, 'artist:nora higuma': 1, 'incomplete': 1, 'character:elizabeth bathory': 1, 'character:ishtar': 1, 'character:scathach': 1, 'group:moonphase': 1, 'artist:yuran': 1, 'artist:tamachi yuki': 1, 'female:tanlines': 1, 'group:treetop helper': 1, 'artist:munashimujou': 1, 'female:bloomers': 1, 'female:farting': 1, 'female:paizuri': 1, 'female:spanking': 1, 'female:wet clothes': 1, 'group:melanchol': 1, 'female:machine': 1, 'group:monsieur': 1, 'artist:muk': 1, 'female:demon girl': 1, 'artist:jairou': 1, 'male:exhibitionism': 1, 'male:robot': 1, 'male:unusual pupils': 6.0099999999999145, 'female:chloroform': 1, 'female:double penetration': 8.244999999999887, 'female:double vaginal': 1, 'female:exhibitionism': 1, 'female:ryona': 4.889999999999938, 'female:triple penetration': 4.83499999999994, 'mmf threesome': 4.109999999999955, 'character:shimakaze': 5.514999999999925, 'group:high fly flow': 1, 'artist:kanimaru': 1, 'male:inflation': 1, 'group:inuteikoku': 1, 'artist:mura': 1, 'male:stomach deformation': 1, 'female:dick growth': 1, 'female:huge penis': 1, 'female:urethra insertion': 1, 'parody:mahou shoujo lyrical nanoha': 1, 'character:hayate yagami': 1, 'group:cyclone': 1, 'artist:izumi': 1, 'artist:reizei': 1, 'female:magical girl': 1, 'parody:gochuumon wa usagi desu ka': 1, 'character:chino kafuu': 1, 'group:second color': 1, 'artist:typehatena': 1, 'parody:the idolmaster': 5.909999999999917, 'character:anastasia': 1, 'character:fumika sagisawa': 1, 'group:zankirow': 1, 'artist:onigirikun': 1, 'female:inverted nipples': 1, 'group:kariya': 1, 'artist:calipur': 1, 'male:bisexual': 1, 'male:chloroform': 1, 'male:netorare': 1, 'male:pegging': 1, 'female:strap-on': 1, 'group:black dog': 1, 'artist:kuroinu juu': 1, 'female:oni': 1, 'artist:sumiya': 1, 'male:harem': 4.79499999999994, 'female:bukkake': 1, 'female:fingering': 1, 'female:harem': 4.704999999999942, 'group:efuya': 1, 'artist:messy': 1, 'female:balljob': 1, 'female:big balls': 1, 'female:frottage': 1, 'female:male on dickgirl': 1, 'female:phimosis': 1, 'female:smell': 1, 'group:shakestyle': 1, 'artist:shake': 1, 'female:sundress': 1, 'character:miyu edelfelt': 1, 'group:rubbish selecting squad': 1, 'artist:namonashi': 1, 'group:orangelepsy': 1, 'male:bukkake': 1, 'male:chastity belt': 5.639999999999922, 'male:garter belt': 1, 'male:orgasm denial': 1, 'male:school swimsuit': 1, 'male:urethra insertion': 1, 'group:tsu ga mittsu.': 1, 'artist:tsuttsu': 1, 'male:piss drinking': 1, 'male:teacher': 1, 'group:calm atmosphere': 1, 'artist:shinya': 1, 'group:misty isle': 1, 'artist:sorimura youji': 1, 'male:blood': 5.674999999999922, 'male:snuff': 5.679999999999922, 'female:gothic lolita': 1, 'female:lingerie': 1, 'female:vampire': 1, 'artist:shiruka bakaudon': 1, 'female:blood': 1, 'female:footjob': 1, 'female:sweating': 1, 'group:rkaffy': 5.814999999999919, 'artist:aichi shiho': 10.149999999999848, 'group:unagigoya': 1, 'artist:sakura puchilo': 1, 'male:bunny boy': 1, 'male:kemonomimi': 9.48499999999986, 'male:leotard': 1, 'group:shoshi magazine hitori': 1, 'artist:coin rand': 1, 'artist:kaitou yuuhi': 1, 'male:catboy': 5.339999999999929, 'artist:dhibi': 1, 'male:elf': 1, 'male:maid': 10.119999999999848, 'group:sakusaku kangen noushuku': 1, 'artist:matashita kintama': 1, 'parody:hunter x hunter': 1, 'character:alluka zoldyck': 1, 'character:killua zoldyck': 1, 'group:miumiu': 1, 'artist:amin': 1, 'artist:minase seri': 1, 'group:kabuttari kaburanakattari': 1, 'artist:seihoukei': 1, 'artist:hanamaki kaeru': 1, 'group:tsf no f': 1, 'artist:hoshino': 1, 'male:gender bender': 1, 'artist:ichimura': 1, 'male:dougi': 1, 'artist:saotome mokono': 10.819999999999833, 'parody:mobile suit gundam tekketsu no orphans': 1, 'character:mikazuki augus': 1, 'character:orga itsuka': 1, 'group:morittokoke': 1, 'artist:morikoke': 1, 'male:business suit': 1, 'artist:chieko': 1, 'character:gudao': 5.969999999999915, 'group:taiyou no megumi': 1, 'artist:yamadori': 1, 'character:rei kagura': 1, 'group:ego dance': 1, 'artist:nanamatsu kenji': 1, 'male:lingerie': 1, 'group:nyala ponga': 1, 'artist:sekai saisoku no panda': 1}
# score_data is from what fetch_score.py gives, I put whole data here for giving sample to make this run.

# the method using here is similar to fetch_score.py, but we got some difference approach here:
# if the tag has been in score_data before, then the tag score is taken from score_data directly,
# if not, then the tag score will be 0 (because user hadn't read it)

for queue in site_data:
    tags = site_data[queue]['metadata']['tags']
    gid = site_data[queue]['metadata']['gid']
    score = 0
    for tag_name in tags:
        if tag_name not in score_data:
            score_list[tag_name] = 0
        else:
            score_list[tag_name] = score_data[tag_name]
            score += np.sum(score_list[tag_name])

    gallery_id = gid
    if gallery_id not in doujin_list:
        doujin_list[gallery_id] = score
    else:
        pass

print(score_list)
# print(heapq.nlargest(8, score_list, key=score_list.get))
# if comment out above line and uncomment second line then it gives top 8 tags which user most reads.
# (really useful for watching what are the users' favorite!)

print(doujin_list)
# gives the reference score for each doujin gallery.
